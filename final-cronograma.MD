# Cronograma de Desenvolvimento - Sistema de An√°lise de Hemogramas
## 4 Semanas - Pacientes Alerta (Linf√≥citos > 400)

---

## üìã **Contexto do Projeto**

### ‚úÖ J√° Implementado:
- Controllers para receber notifica√ß√µes FHIR (`FhirSubscriptionController`)
- Gerador de hemogramas sint√©ticos (`SyntheticHemogramController`)
- Parser FHIR para processar hemogramas
- Sistema de armazenamento em buffer (n√£o persistente)
- API b√°sica para consultar hemogramas (`HemogramaApiController`)

### üéØ A Implementar:
1. **Gerador de Dados de Pacientes via FHIR** (mock)
2. **Endpoints Estat√≠sticos** (por idade, regi√£o, sexo)
3. **Sistema de Notifica√ß√µes em Tempo Real** (WebSocket/SSE)
4. **Persist√™ncia apenas dos resultados estat√≠sticos**
5. **Processamento cont√≠nuo** (1000 hemogramas/dia)

---

# üìÖ ORGANIZA√á√ÉO POR SEMANAS

---

# üóìÔ∏è **SEMANA 1: Funda√ß√£o - Pacientes e Detec√ß√£o de Alertas**
**Objetivo:** Criar infraestrutura b√°sica para gerar pacientes, detectar alertas e persistir estat√≠sticas

### **Segunda-feira (Dia 1-2)**
**Objetivo:** Criar modelo de dom√≠nio e gerador de pacientes FHIR

#### Tarefas:
- [ ] **Criar DTOs de Paciente**
  - `PacienteDto.java` (id, nome, idade, sexo, regi√£o, CPF)
  - `PacienteAlertaDto.java` (dados do paciente + dados do hemograma alerta)
  
- [ ] **Criar `SyntheticPatientGeneratorService`**
  - Gerar pacientes em formato FHIR Resource (Patient)
  - Distribui√ß√£o realista por:
    - Idade (0-100 anos, com curva normal centrada em 45)
    - Sexo (50% M, 50% F)
    - Regi√£o (Norte, Nordeste, Centro-Oeste, Sudeste, Sul - propor√ß√£o populacional brasileira)
  - Incluir dados fict√≠cios: nome (Faker), CPF gerado, endere√ßo por regi√£o

- [ ] **Criar `PatientFhirParserService`**
  - Parsear FHIR Patient Resource para `PacienteDto`
  - Extrair: idade, sexo, regi√£o (do endere√ßo)

**Entreg√°vel:** Servi√ßos funcionais para gerar e parsear pacientes FHIR

---

### **Ter√ßa-feira (Dia 3)**
**Objetivo:** Criar l√≥gica de detec√ß√£o de alerta e associa√ß√£o paciente-hemograma

#### Tarefas:
- [ ] **Atualizar `HemogramaDto`**
  - Adicionar campo `linfocitos` (BigDecimal)
  - Adicionar campo `pacienteId` (String)
  - Manter flag `riscoHiv` renomeada para `isAlerta`
  - Atualizar `motivoRisco` para `motivoAlerta` ("Linf√≥citos > 400")

- [ ] **Criar `AlertaDetectionService`**
  - M√©todo `boolean isAlerta(HemogramaDto)` - verifica se linf√≥citos > 400
  - M√©todo `PacienteAlertaDto criarAlerta(HemogramaDto, PacienteDto)`
  - Log de detec√ß√£o de alertas

- [ ] **Atualizar `SyntheticHemogramGeneratorService`**
  - Gerar valor de linf√≥citos (distribui√ß√£o: 80% normal 200-350, 20% alerta 400-800)
  - Associar hemograma a um `pacienteId`

**Entreg√°vel:** Sistema de detec√ß√£o de alertas funcional

---

### **Quarta-feira (Dia 4)**
**Objetivo:** Criar controller de gera√ß√£o integrada

#### Tarefas:
- [ ] **Criar `SyntheticDataController`**
  - `POST /synthetic/generate-complete?quantidade=N`
    - Gera N pacientes FHIR
    - Gera N hemogramas FHIR associados aos pacientes
    - Detecta alertas
    - Retorna resumo: total gerado, alertas detectados
  
  - `GET /synthetic/test-alert`
    - Gera 1 paciente + 1 hemograma garantidamente alerta (linf√≥citos = 500)
    - Para testes do sistema de notifica√ß√£o

**Entreg√°vel:** Endpoint de gera√ß√£o completa funcionando

---

### **Quinta-feira (Dia 5)**
**Objetivo:** Modelar banco de dados para estat√≠sticas

#### Tarefas:
- [ ] **Criar Entities JPA**
  - `EstatisticaAlertaPorIdade` (faixaEtaria, quantidade, dataCalculo)
    - Faixas: 0-18, 19-30, 31-45, 46-60, 61-75, 76+
  
  - `EstatisticaAlertaPorRegiao` (regiao, quantidade, dataCalculo)
    - Regi√µes: Norte, Nordeste, Centro-Oeste, Sudeste, Sul
  
  - `EstatisticaAlertaPorSexo` (sexo, quantidade, dataCalculo)
    - Sexo: M, F

- [ ] **Criar Repositories**
  - `EstatisticaAlertaPorIdadeRepository`
  - `EstatisticaAlertaPorRegiaoRepository`
  - `EstatisticaAlertaPorSexoRepository`

- [ ] **Configurar PostgreSQL/MySQL**
  - Scripts de cria√ß√£o de tabelas
  - √çndices para otimizar queries por data

**Entreg√°vel:** Modelo de dados para estat√≠sticas pronto

---

### **Sexta-feira (Dia 6-7)**
**Objetivo:** Criar servi√ßo de c√°lculo de estat√≠sticas

#### Tarefas:
- [ ] **Criar `EstatisticasAlertaService`**
  - `calcularEstatisticasPorIdade(List<PacienteAlertaDto>)` ‚Üí persiste no banco
  - `calcularEstatisticasPorRegiao(List<PacienteAlertaDto>)` ‚Üí persiste no banco
  - `calcularEstatisticasPorSexo(List<PacienteAlertaDto>)` ‚Üí persiste no banco
  - M√©todo `processarNovoAlerta(PacienteAlertaDto)` - atualiza estat√≠sticas incrementalmente

- [ ] **Criar l√≥gica de agrega√ß√£o**
  - Agrupar alertas por faixa et√°ria
  - Agrupar alertas por regi√£o
  - Agrupar alertas por sexo

- [ ] **Testes Unit√°rios**
  - Testar c√°lculo de estat√≠sticas com dados mockados

**Entreg√°vel:** Servi√ßo de estat√≠sticas completo e testado

---

## üóìÔ∏è **SEMANA 2: APIs Estat√≠sticas e Notifica√ß√µes**

### **Segunda-feira (Dia 8)**
**Objetivo:** Criar endpoints de estat√≠sticas

#### Tarefas:
- [ ] **Criar `EstatisticasAlertaController`**
  - `GET /api/estatisticas/alertas/idade`
    - Retorna estat√≠sticas agrupadas por faixa et√°ria
    - Par√¢metros: `dataInicio`, `dataFim` (opcional)
  
  - `GET /api/estatisticas/alertas/regiao`
    - Retorna estat√≠sticas por regi√£o
  
  - `GET /api/estatisticas/alertas/sexo`
    - Retorna estat√≠sticas por sexo
  
  - `GET /api/estatisticas/alertas/resumo`
    - Retorna resumo geral: total alertas, distribui√ß√£o por idade/regi√£o/sexo

**Entreg√°vel:** Endpoints REST de estat√≠sticas funcionais

---

### **Ter√ßa-feira (Dia 9-10)**
**Objetivo:** Implementar sistema de notifica√ß√µes em tempo real

#### Tarefas:
- [ ] **Escolher Tecnologia: Server-Sent Events (SSE)**
  - Mais simples que WebSocket
  - Unidirecional (servidor ‚Üí cliente)
  - Ideal para notifica√ß√µes de alertas

- [ ] **Criar `NotificacaoAlertaService`**
  - Gerenciar lista de clientes conectados (`SseEmitter`)
  - M√©todo `notificarNovoAlerta(PacienteAlertaDto)`
  - M√©todo `registrarCliente()` ‚Üí retorna `SseEmitter`

- [ ] **Criar `NotificacoesAlertaController`**
  - `GET /api/notificacoes/alertas/stream` (endpoint SSE)
    - Cliente se conecta e recebe notifica√ß√µes em tempo real
    - Retorna eventos no formato JSON:
      ```json
      {
        "tipo": "NOVO_ALERTA",
        "timestamp": "2025-11-10T14:30:00",
        "paciente": {
          "id": "PAC-123",
          "nome": "Jo√£o Silva",
          "idade": 45,
          "sexo": "M",
          "regiao": "Sudeste"
        },
        "hemograma": {
          "observationId": "OBS-456",
          "linfocitos": 520,
          "dataColeta": "2025-11-10T14:25:00"
        }
      }
      ```

- [ ] **Integrar com `AlertaDetectionService`**
  - Ao detectar alerta, chamar `NotificacaoAlertaService.notificarNovoAlerta()`

**Entreg√°vel:** Sistema de notifica√ß√µes SSE funcionando

---

### **Quarta-feira (Dia 11)**
**Objetivo:** Criar job agendado para processamento cont√≠nuo

#### Tarefas:
- [ ] **Criar `ProcessamentoContinuoService`**
  - Usar `@Scheduled` do Spring
  - Job executado a cada 24 horas / n√∫mero de lotes
    - Exemplo: 1000 hemogramas/dia = ~42 hemogramas/hora = processar a cada hora
  
  - Fluxo do job:
    1. Gerar lote de pacientes + hemogramas
    2. Detectar alertas
    3. Atualizar estat√≠sticas
    4. Enviar notifica√ß√µes
    5. Descartar dados de pacientes/hemogramas (n√£o persistir)

- [ ] **Configurar agendamento**
  - `@EnableScheduling` na aplica√ß√£o
  - Configurar cron expression para execu√ß√£o cont√≠nua

**Entreg√°vel:** Job agendado funcionando

---

### **Quinta-feira (Dia 12)**
**Objetivo:** Testes de integra√ß√£o

#### Tarefas:
- [ ] **Criar testes de integra√ß√£o**
  - Testar fluxo completo: gera√ß√£o ‚Üí detec√ß√£o ‚Üí estat√≠sticas ‚Üí notifica√ß√£o
  - Testar endpoints REST com dados mockados
  - Testar conex√£o SSE (simular cliente)

- [ ] **Testar performance**
  - Gerar 1000 hemogramas e medir tempo de processamento
  - Verificar uso de mem√≥ria (dados n√£o devem ficar em mem√≥ria ap√≥s processamento)

**Entreg√°vel:** Suite de testes de integra√ß√£o

---

### **Sexta-feira (Dia 13-14)**
**Objetivo:** Criar dashboard simples de monitoramento

#### Tarefas:
- [ ] **Criar `MonitoramentoController`**
  - `GET /api/monitor/status`
    - Total de hemogramas processados hoje
    - Total de alertas hoje
    - Taxa de alertas (%)
    - √öltimo processamento
  
  - `GET /api/monitor/health`
    - Status do job agendado
    - N√∫mero de clientes conectados (SSE)
    - Estat√≠sticas do banco

**Entreg√°vel:** Endpoints de monitoramento

---

## üóìÔ∏è **SEMANA 3: Otimiza√ß√£o e Documenta√ß√£o**

### **Segunda-feira (Dia 15)**
**Objetivo:** Otimizar consultas e √≠ndices do banco

#### Tarefas:
- [ ] **Otimiza√ß√£o de Queries**
  - Adicionar √≠ndices compostos em `dataCalculo` + dimens√£o (idade/regi√£o/sexo)
  - Implementar cache para estat√≠sticas frequentes (Spring Cache)

- [ ] **Otimizar detec√ß√£o de alertas**
  - Processar hemogramas em batch (n√£o um por um)
  - Usar streams paralelos para processar lotes grandes

**Entreg√°vel:** Sistema otimizado

---

### **Ter√ßa-feira (Dia 16)**
**Objetivo:** Criar documenta√ß√£o da API

#### Tarefas:
- [ ] **Configurar Swagger/OpenAPI**
  - Adicionar depend√™ncia `springdoc-openapi`
  - Documentar todos os endpoints
  - Adicionar exemplos de requests/responses

- [ ] **Criar README t√©cnico**
  - Arquitetura do sistema
  - Fluxo de dados
  - Como executar
  - Exemplos de uso

**Entreg√°vel:** Documenta√ß√£o completa

---

### **Quarta-feira (Dia 17)**
**Objetivo:** Implementar logs estruturados e m√©tricas

#### Tarefas:
- [ ] **Melhorar logging**
  - Adicionar trace IDs para rastreamento
  - Logs estruturados (JSON) com n√≠veis adequados
  - Log de todos os alertas detectados

- [ ] **Adicionar m√©tricas (Micrometer)**
  - Contador de alertas detectados
  - Tempo de processamento de hemogramas
  - Taxa de alertas por hora

**Entreg√°vel:** Observabilidade melhorada

---

### **Quinta-feira (Dia 18)**
**Objetivo:** Testes de carga

#### Tarefas:
- [ ] **Criar cen√°rios de teste com JMeter/Gatling**
  - Simular 1000 hemogramas/hora
  - Simular 50 clientes conectados ao SSE
  - Medir lat√™ncia dos endpoints de estat√≠sticas

- [ ] **Ajustar configura√ß√µes**
  - Pool de threads
  - Timeouts
  - Limites de mem√≥ria

**Entreg√°vel:** Sistema validado para carga de produ√ß√£o

---

### **Sexta-feira (Dia 19-21)**
**Objetivo:** Refatora√ß√£o e code review

#### Tarefas:
- [ ] **Refatorar c√≥digo**
  - Eliminar duplica√ß√µes
  - Melhorar nomes de vari√°veis/m√©todos
  - Adicionar coment√°rios onde necess√°rio

- [ ] **Code review**
  - Revisar seguran√ßa (valida√ß√µes de input)
  - Revisar tratamento de erros
  - Revisar estrutura de pacotes

**Entreg√°vel:** C√≥digo limpo e revisado

---

## üóìÔ∏è **SEMANA 4: Frontend Integration & Deploy**

### **Segunda-feira (Dia 22)**
**Objetivo:** Criar exemplo de cliente SSE

#### Tarefas:
- [ ] **Criar p√°gina HTML de teste**
  - Conectar ao endpoint SSE
  - Exibir alertas em tempo real
  - Gr√°ficos simples com Chart.js

- [ ] **Documentar integra√ß√£o frontend**
  - Exemplo em JavaScript puro
  - Exemplo em React
  - Como tratar reconex√£o autom√°tica

**Entreg√°vel:** Exemplo funcional de integra√ß√£o

---

### **Ter√ßa-feira (Dia 23)**
**Objetivo:** Configurar ambiente de produ√ß√£o

#### Tarefas:
- [ ] **Dockerizar aplica√ß√£o**
  - Criar `Dockerfile`
  - Criar `docker-compose.yml` (app + banco)

- [ ] **Configurar vari√°veis de ambiente**
  - Separar configura√ß√µes de dev/prod
  - Externalizar secrets

**Entreg√°vel:** Aplica√ß√£o containerizada

---

### **Quarta-feira (Dia 24)**
**Objetivo:** Testes de aceita√ß√£o

#### Tarefas:
- [ ] **Validar requisitos**
  - ‚úÖ Gera pacientes FHIR mockados
  - ‚úÖ Detecta alertas (linf√≥citos > 400)
  - ‚úÖ Endpoints de estat√≠sticas (idade, regi√£o, sexo)
  - ‚úÖ Notifica√ß√µes em tempo real
  - ‚úÖ Processamento cont√≠nuo (1000/dia)
  - ‚úÖ Persiste apenas estat√≠sticas (n√£o hemogramas/pacientes)

- [ ] **Testes end-to-end**
  - Simular dia completo de processamento
  - Verificar consist√™ncia das estat√≠sticas

**Entreg√°vel:** Sistema validado

---

### **Quinta-feira (Dia 25)**
**Objetivo:** Deploy em ambiente de homologa√ß√£o

#### Tarefas:
- [ ] **Deploy**
  - Configurar servidor (AWS/Azure/GCP ou local)
  - Subir aplica√ß√£o e banco
  - Testar em ambiente real

- [ ] **Monitoramento**
  - Configurar logs centralizados
  - Configurar alertas de erro

**Entreg√°vel:** Sistema em homologa√ß√£o

---

### **Sexta-feira (Dia 26-28)**
**Objetivo:** Ajustes finais e entrega

#### Tarefas:
- [ ] **Ajustes finais**
  - Corrigir bugs encontrados em homologa√ß√£o
  - Ajustar performance se necess√°rio

- [ ] **Documenta√ß√£o final**
  - Manual de opera√ß√£o
  - Guia de troubleshooting
  - Apresenta√ß√£o do projeto

- [ ] **Apresenta√ß√£o**
  - Demo ao vivo
  - Explica√ß√£o da arquitetura
  - M√©tricas e resultados

**Entreg√°vel:** Sistema completo e documentado

---

## üìä **Estrutura Final do Projeto**

```
src/main/java/...hemograma/
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ FhirSubscriptionController.java (j√° existe)
‚îÇ   ‚îú‚îÄ‚îÄ HemogramaApiController.java (j√° existe)
‚îÇ   ‚îú‚îÄ‚îÄ SyntheticHemogramController.java (j√° existe)
‚îÇ   ‚îú‚îÄ‚îÄ SyntheticDataController.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ EstatisticasAlertaController.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ NotificacoesAlertaController.java (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ MonitoramentoController.java (NOVO)
‚îÇ
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îú‚îÄ‚îÄ HemogramaDto.java (atualizar)
‚îÇ   ‚îú‚îÄ‚îÄ PacienteDto.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ PacienteAlertaDto.java (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ EstatisticasDto.java (NOVO)
‚îÇ
‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îú‚îÄ‚îÄ EstatisticaAlertaPorIdade.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ EstatisticaAlertaPorRegiao.java (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ EstatisticaAlertaPorSexo.java (NOVO)
‚îÇ
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ EstatisticaAlertaPorIdadeRepository.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ EstatisticaAlertaPorRegiaoRepository.java (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ EstatisticaAlertaPorSexoRepository.java (NOVO)
‚îÇ
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ HemogramaFhirParserService.java (j√° existe)
‚îÇ   ‚îú‚îÄ‚îÄ HemogramaStorageService.java (j√° existe)
‚îÇ   ‚îú‚îÄ‚îÄ SyntheticHemogramGeneratorService.java (j√° existe)
‚îÇ   ‚îú‚îÄ‚îÄ SyntheticPatientGeneratorService.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ PatientFhirParserService.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ AlertaDetectionService.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ EstatisticasAlertaService.java (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ NotificacaoAlertaService.java (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ ProcessamentoContinuoService.java (NOVO)
‚îÇ
‚îî‚îÄ‚îÄ config/
    ‚îú‚îÄ‚îÄ SchedulingConfig.java (NOVO)
    ‚îú‚îÄ‚îÄ CacheConfig.java (NOVO)
    ‚îî‚îÄ‚îÄ SwaggerConfig.java (NOVO)
```

---

## üéØ **Crit√©rios de Sucesso**

### Funcionalidades Obrigat√≥rias:
- ‚úÖ Gerador de pacientes FHIR com dados realistas
- ‚úÖ Detec√ß√£o autom√°tica de alertas (linf√≥citos > 400)
- ‚úÖ 3 endpoints de estat√≠sticas (idade, regi√£o, sexo)
- ‚úÖ Notifica√ß√µes em tempo real via SSE
- ‚úÖ Processamento cont√≠nuo de 1000 hemogramas/dia
- ‚úÖ Persist√™ncia apenas de estat√≠sticas (n√£o dados brutos)

### Qualidade:
- ‚úÖ Cobertura de testes > 80%
- ‚úÖ Documenta√ß√£o completa (Swagger + README)
- ‚úÖ Logs estruturados e rastre√°veis
- ‚úÖ Performance adequada (processar 1000 hemogramas em < 5 minutos)

---

## üí° **Observa√ß√µes Importantes**

1. **N√£o persistir dados brutos:** Pacientes e hemogramas s√£o processados e descartados. Apenas estat√≠sticas s√£o salvas.

2. **Distribui√ß√£o realista:** Garantir que 15-20% dos hemogramas gerem alertas (linf√≥citos > 400).

3. **Notifica√ß√µes:** SSE √© mais simples que WebSocket para notifica√ß√µes unidirecionais.

4. **Escalabilidade:** Job agendado pode ser ajustado (ex: processar a cada hora em vez de uma vez ao dia).

5. **Monitoramento:** Sempre ter visibilidade do n√∫mero de alertas detectados e estat√≠sticas em tempo real.

---

## üìû **Pontos de Aten√ß√£o**

- **Semana 1:** Base fundamental - n√£o pular etapas
- **Semana 2:** Sistema de notifica√ß√µes √© cr√≠tico - testar bem
- **Semana 3:** Otimiza√ß√£o √© essencial para processar 1000/dia
- **Semana 4:** Deploy e valida√ß√£o - reservar tempo para imprevistos